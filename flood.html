<!DOCTYPE html><html><head><style>#b{background:#334;margin:0 auto;width:70vw;padding:1em;color:#eee;white-space:nowrap}div{display:inline-block;width:7vw;height:7vw;padding:0;border:solid #334 2pt}.c{cursor:pointer;border-color:#ccc}</style><title>Flood</title></head><body id="b"><h1>Flood</h1><p>Game size is ??? bytes</p><p>Moves: <span id="s">0</span></p><script>d=document;s=d[x="getElementById"]`s`;b=d[x]`b`;r=i=>i*Math.random()|0;
t=[[]];
for(x=y=0;x<9|y<9;x++){
	if(x>9)x=0,y++,t[y]=[],b[B](d[E]`br`);
	v=1+r(6);
	a=i=>v&i?'c':'6';
	b[B="appendChild"](t[y][x]=d[E="createElement"]`div`)[l="style"][c="background"]="#"+a(1)+a(2)+a(4);
}
b[B](t[9][9]=d[E]`div`)[l][c]="#ccc";
p=(x,y)=>{t[y][x][u="className"]="c";t[y][x][o="onclick"]=_=>{
	s.innerHTML++;
	A=[...Array(10)].map(_=>[]);
	k=t[9][9][l][c];
	h=t[y][x][l][c];
	X=(x,y,i)=>{
			//console.log("DEBUG: X("+x+", " + y+", " +i+")");
			var n=t[y][x],K=(z,w)=>{z+=x;w+=y;z<0|w<0|z>9|w>9?0:(0|A[z][w])<i+1?f[i](z,w,t[w][z],A[z][w]=i+1):0};
			n[u]="";
			n[o]=_=>0;
			K(0,1);K(1,0);K(0,-1);K(-1,0)
		}
	f=[
		p,
		(x,y,n)=>n[l][c]==h?X(x,y,1):p(x,y),
		(x,y,n)=>(v=n[l][c])==k||v==h?X(x,y,v==k?2:1,n[l][c]=h):p(x,y)
	];
	//f.map((f,i)=>(x,y,n)=>{console.log("DEBUG: f["+i+"]("+x+", "+y+",_)");f(x,y,n)});
	f[2](9,9,t[9][9],A[9][9]=3)

/*
	f=(z,w)=>{
		if(!A[z][w]){
			A[z][w]=1;
			n=t[w][z];
			n[u]="";
			n[o]=_=>0;
			K=(x,y)=>{
				x+=z;y+=w;
				x<0|y<0|x>9|y>9?0:f(x,y)
			}
			(v=n[l][c])==k||v==h?(n[l][c]=h,K(0,1),K(1,0),K(0,-1),K(-1,0)):p(z,w)
		}
	}
	f(9,9)
	*/

}}
p(8,9);p(9,8)
</script></body></html>
